# 6장. HTTP 헤더

## HTTP 메시지 헤더

**HTTP 프로토콜의 리퀘스트와 리스폰스에는 반드시 메시지 헤더가 포함된다.**

- 메시지 헤더: 클라이언트나 서버가 리퀘스트나 리스폰스를 처리하기 위한 정보를 포함한다
- 리퀘스트의 HTTP 메시지 구성
    - 메소드 , URI , HTTP 버전 , HTTP 헤더 필드로 구성
- 리스폰스의 HTTP 메시지
    - HTTP 메시지 , HTTP 버전 , 상태코드(코드와 설명) , HTTP 헤더 필드로 구성

---

## HTTP 헤더 필드

**HTTP 헤더 필드는 메시지 바디의 크기, 사용하고 있는 언어, 인증 정보 등을 포함한다.**

HTTP 헤더 필드의 구조

- `헤더 필드 명 : 필드 값`

하나의 헤더 필드가 여러 개의 필드 값을 가질 수도 있다.

- `Content-Type:text/html`

**HTTP 헤더 필드가 중복된 경우**

- 사양으로 명확하게 정해져 있지 않기 때문에 브라우저마다 다른 동작을 하게 된다.
- 어떤 브라우저는 최초의 헤더 필드를 우선적으로 처리하고, 어떤 브라우저는 마지막 헤더 필드를 우선적으로 처리한다.

### **4종류의 HTTP 헤더 필드**

**일반적 헤더 필드(General Header Fields)**

- 리퀘스트 메시지와 리스폰스 메시지 둘 다 사용되는 헤더

**리퀘스트 헤더 필드(Request Header Fields)**

- 클라이언트 측에서 서버 측으로 송신된 리퀘스트 메시지에 사용되는 헤더리퀘스트의 부가적 정보와 클라이언트의 정보, 리스폰스의 콘텐츠에 관한 우선 순위 등을 부가한다.

**리스폰스 헤더 필드(ResponseHeader Fields)**

- 서버 측에서 클라이언트 측으로 송신한 리스폰스 메시지에 사용되는 헤더리스폰스의 정보와 서버의 정보, 클라이언트의 추가 정보 요구 등을 부가한다.

**엔티티 헤더 필드(Entity Header Fields)**

- 리퀘스트 메시지와 리스폰스 메시지에 포함된 엔티티에 사용되는 헤더콘텐츠 갱신 시간 등의 엔티티에 관한 정보를 부가한다.

### **End-to-end 헤더와 Hop-by-hop 헤더**

**End-to-end 헤더**

- 이 카테고리에 분류된 헤더는 리퀘스트나 리스폰스의 최종 수신자에게 전송된다.
- 캐시에서 구축된 리스폰스 중 보존되어야 하고, 다시 전송되지 않으면 안되도록 되어 있다.

**Hop-by-hop 헤더**

- 이 카테고리에 분류된 헤더는 한 번 전송에 대해서만 유효하고 캐시와 프록시에 의해서 전송되지 않는 것도 있다.

**hop-by-bop 헤더 종류**

- Connection
- Keep-Alive
- proxy-Authenticate
- Proxy-Authorization
- Trailer
- TE
- Transfer-Encoding
- Upgrade

**end-to-end 헤더 종류**

- 위 8개를 제외한 모든 헤더 필드

---

## **HTTP/1.1 일반 헤더 필드**

→ 리퀘스트 메시지와 리스폰스 메시지 양쪽에서 사용되는 헤더

### Cache-Control

- 디렉티브 명령으로 캐싱 동작 지정
    - 디렉티브 여러개일 경우 `,`로 구분
    

### Connection

1. 프록시에 더 이상 전송하지 않는 헤더 필드를 지정
    - hop-by-hop 헤더로 지정
2. 지속적 접속 관리
    - HTTP/1.1에서 지속적 접속은 default 값이다. 리퀘스트를 송신한 클라이언트의 접속은 계속 유지되고, 추가 리퀘스트를 송신한한다.
    - 서버에서 명시적으로 접속을 끊고 싶다면 Connection 헤더 필드에 Close를 지정한다.
        - `Connection : Close`
    

### Date

- HTTP를 생성한 날짜

### Pragma

- HTTP/1.0 이전 버전과 호환성을 위해 정의된 헤더필드
    - 클라이언트의 리퀘스트에서만 사용가능
    - Pragma: no-cache 의 형식만 지정 가능하며, 캐시된 리소스의 리스폰스를 원하지 않음을 모든 중간 서버에 알리기 위해 사용한다.

### Trailer

- 메시지 바디의 뒤에 기술되어 있는 헤더 필드를 미리 전달

### Transfer-Encodiing

- 메시지 바디의 전송 코딩 형식을 지정하는 경우에 사용

### Upgrade

- HTTP 및 다른 프로토콜의 새로운 버전이 통신에 이용되는 경우에 사용

### Via

- 클라이언트와 서버 간의 리퀘스트나 리스폰스 메시지의 경로 추적을 위해 사용
- 프록시 혹은 게이트웨이는 자신의 섭 정보를 `Via` 헤더 필드에 추가한 뒤에 메시지 전송

### Warning

- 리스폰스에 관한 추가 정보 전달
- 보통 캐시에 관한 문제의 경고를 유저에게 전달한다.

---

## 리퀘스트 헤더 필드

- 리퀘스트의 부가 정보
- 클라이언트의 정보
- 리스폰스의 콘텐츠에 관한 우선 순위 등 추가

### Accept

- 유저 에이전트에 처리할 수 있는 미디어 타입과 미디어 타입의 상대 우선순위 전달 (텍스트 파일, 이미지 파일, 동영상 파일, 애플리케이션용 바이너리 파일 등)

### Accept-Charset

- 유저 에이전트에서 처리할 수 있는 문자셋

### Accept-Encoding

- 유저 에이전트가 처리할 수 있는 컨텐츠 로딩과 컨텐츠 코딩의 상대 우선 순위 전달

### Accept-Language

- 유저 에이전트가 처리할 수 있는 자연어 세트와 자연어 세트의 상대 우선 순위 전달

### Authorization

- 유저 에이전트의 인증 정보를 전달

### Expect

- 클라이언트가 서버에 특정 동작 요구를 전달

### From

- 유저 에이전트를 사용하고 있는 유저의 메일 주소를 전달
    - 기본적으로 검색 엔진 등의 에이전트 책임자에게 연락처 메일 주소를 나타내는 목적

### Host

- 리퀘스트한 리소스의 인터넷 호스트와 포트 번호를 전달
- **유일한 필수 헤더 필드**

### If-Match

- 조건부 리퀘스트
    - 지정된 조건에 맞는 경우에만 서버가 리퀘스트를 받음

### If-Modified-Since

- 필드 값에 지정된 날짜 이후에 갱신된 리소스라면 리퀘스트를 받음

### If-None-Match

- 필드값에 지정된 ETag 값이 지정된 리소스의 ETag 값과 일치하지 않을 때만 리퀘스트를 받아들임
    - If-Match와 반대로 동작

### If-Range

- 필드값과 지정한 리소스의 ETag 값 혹은 날짜가 일치하면 Range 리퀘스트로 처리함
    - 일치하지 않을 경우 리소스 전체 반환

### If-Unmodified-Since

- 지정된 리소스가 필드 값에 지정된 날짜 이후에 갱신되어 있지 않은 경우에만 리퀘스트 받아들임
    - If-Modified-Since와 반대로 동작

### Max-Forwards

- 경유 가능한 서버 수의 최대치
- 받아넘길 때마다 1씩 뺀다.

### Proxy-Authorization

- 프록시 서버에서의 인증 요구를 받아들일 때 인증에 필요한 클라이언트의 정보를 전달

### Range

- 리소스의 일부만 취득하는 Range 리퀘스트를 할 때 지정 범위를 전달

### Referer

- 리퀘스트의 본래 리소스의 URI를 전달

### TE

- 리스폰스로 받을 수 있는 전송 코딩의 형식과 상대 우선 순위 전달

### User-Agent

- 리퀘스트를 생성한 브라우저와 유저 에이전트의 이름을 전달

---

## 리스폰스 헤더 필드

- 리스폰스의 부가 정보
- 서버의 정보
- 클라이언트에 부가 정보 요구 등

### Accept-Ranges

- Range 리퀘스트를 접수할 수 있는지의 여부를 전달

### Age

- 오리진 서버에서 얼마나 오래 전에 리스폰스가 생성되었는지 전달 (단위: 초)

### ETag

- = 엔티티 태그
- 리소스를 특정하기 위한 문자열을 전달
    1. 강한 ETag : 엔티티가 아주 조금 다르더라도 반드시 값이 변화한다.
    2. 약한 ETag : 리소스가 같다는 것만을 나타낸다.의미가 다른 리소스일 경우만 값이 변화하며, 값의 앞부분에 "W/"가 붙는다.

### Location

- 리소스 액세스를 유도하는 경우에 사용

### Proxy-Authenticate

- 프록시 서버에서의 인증 요구를 클라이언트에게 전달

### Retry-After

- 클라이언트가 일정 시간 후에 리퀘스트를 다시 시행해야하는지를 전달

### Server

- 서버에 설치되어 있는 HTTP 서버의 소프트웨어 전달

### Vary

- 캐시를 컨트롤하기 위해 사용

### WWW-Authenticate

- HTTP 액세스 인증에 사용
- 상태코드 401 리스폰스에 반드시 포함됨

---

## 엔티티 헤더 필드

리퀘스트 메시지와 리스폰스 메시지에 포함된 엔티티에 사용되는 헤더

- 콘텐츠의 갱신 시간과 같은 엔티티에 대한 정보를 포함

### Allow

- Request-URI에 지정된 리소스가 제공하는 메소드 목록 전달

### Content-Encoding

- 서버가 엔티티 바디에 대해서 실시한 콘텐츠 코딩 형식 지정

### Content-Language

- 엔티티 바디에 사용된 자연어 전달

### Content-Length

- 엔티티 바디의 크기를 전달 (단위: 바이트)

### Content-Location

- 메시지 바디에 대응하는 URI를 전달
    - 메시지 바디로 반환된 리소스의 URI를 나타낸다는 점에서 Location 헤더 필드와 차이

### Content-MD5

- 메시지 바디가 변경되지 않고 도착했는지 확인하기 위해 MD5 알고리즘에 의해 생성된 값 전달

### Content-Range

- 범위를 지정해서 일부분만을 리퀘스트하는 Range 리퀘스트에 대해 리스폰스 할 때 사용

### Content-Type

- 엔티티 바디에 포함되는 오브젝트의 미디어 타입을 전달

### Expires

- 리소스의 유효 기한 날짜 전달

### Last-Modified

- 리소스가 마지막으로 갱신되었던 날짜 정보를 전달

---

## 쿠키 헤더 필드

**쿠키**

- **유저 식별**과 **상태 관리**에 사용
- 쿠키 호출 시 쿠키의 유효 기한과 송신지 도메인, 경로, 프로토콜 등을 체크하기 때문에 데이터 도난의 위험이 적다.

### Set-Cookie

- 서버가 클라이언트에 대해 상태 관리를 시작할 때 댜양한 정보를 전달
    - Expires 속성: 브라우저가 쿠키를 송출할 수 있는 유효 기간 지정
    - Path 속성: 쿠키를 송출하는 범위를 특정 디렉토리에 한정
    - Domain 속성: 지정된 도메인 명은 후방 일치가 됨
    - Secure 속성: 웹 페이지가 HTTPS에서 열렸을 때에만 쿠키 송출을 제한
    - HttpOnly 속성: 자바스크립트를 경유하는 방식으로 쿠키를 취득하지 못하도록 막음

### Cookie

- 클라이언트가 HTTP의 상태 관리 지원을 원할 때 서버로부터 수신한 쿠키를 이후의 리퀘스트에 포함해서 전달
- 쿠키를 여러개 수신할 때, 쿠키를 여러개 보내는 것도 가능

---

## 기타 헤더 필드

- 웹 서버와 브라우저의 기능에 대해 독자적인 헤더 필드 존재

### X-frame-Option

- 다른 웹 사이트의 프레임에서 표시를 제어하는 HTTP 리스폰스 헤더

### X-XSS-Protection

- 크로스 사이트 스크립팅 대첵: 브라우저의 XSS 보호 기능을 제어하는 HTTP 리스폰스 헤더

### DNT

- Do Not Track
- 개인 정보 수집을 거부를 나타내는 HTTP 리퀘스트 헤더

### P3P

- 웹 사이트 상의 프라이버시 정책에 P3P를 사용하는 것
