# 3장)HTTP정보는 HTTP 메시지에 있다

## HTTP 메시지

- HTTP에서 교환하는 정보
- 복수 행의 데이터로 구성돤 텍스트 문자열
- 메시지 헤더 + 메시지 바디 (최초 개행으로 둘을 구분)
- 메시지 바디는 존재하지 않을 수 있음

## 메시지 헤더

### Request

1. **리퀘스트 라인 :** HTTP method, URI, HTTP 버전으로 구성
2. 리퀘스트 헤더 필드
3. 일반 헤더 필드
4. 엔티티 헤더 필드

### Response

1. **상태 라인 :** HTTP 상태코드, 설명, HTTP 버전으로 구성
2. 리퀘스트 헤더 필드
3. 일반 헤더 필드
4. 엔티티 헤더 필드

## 인코딩으로 전송 효율을 높이다

 HTTP로 데이터를 전송할 때, 인코딩을 실시함으로써 다량의 액세스를 효율 좋게 처리하여 전송 효율을 증가
하지만, 인코딩 처리를 위해 CPU 등의 리소스는 보다 많이 소비

### 메시지 바디와 엔티티 바디의 차이

**메시지**

HTTP 통신의 기본 단위, 옥텟 시퀀스로 구성되고 통신을 통해서 전송

**엔티티**

Request와 Response의 페이로드로 전송되는 정보, 엔티티 헤더 필드와 엔티티 바디로 구성

**HTTP 메시지 바디의 역할**

Request와 Response에 대한 엔티티 바디를 운반

✔️ 기본적으로 메시지 바디와 엔티티 바디는 같지만 전송 코딩이 적용된 경우에는 엔티티 바디의 내용이 변화하기 때문에 메시지 바디와 달라짐

### 콘텐츠 코딩(Content Coding)

용량이 큰 엔티티를 작게 압축(인코딩)해서 클라이언트로 보내고, 클라이언트에서 디코딩을 하는 방식

### 청크 전송 코딩(Chunked Transfer Coding)

사이즈가 큰 엔티디 바디를 여러 청크(덩어리)로 분해 클라이언트로 전송하고 클라이언트에서 디코딩하는 방식

청크 사이즈를 16진수로 사용해서 단락을 표시하고 엔티티 바디 끝에는 0(CR+LF)를 기록

### 멀티파트

메일로 텍스트, 영상, 이미지 등 여러 데이터들을 한번에 다루기 위한 MIME이라는 기술의 확장 사양

HTTP는 멀티 파트를 이용해 여러 엔티티를 하나의 메시지 바디에 포함시켜서 전송

**multipart/form-data**

→ web 폼으로부터 파일 업로드에 사용

**multopart/byteranges**

→상태 코드 206(Partial Content) 리스폰스 메시지가 복수 범위의 내용을 포함하는 때에 사용

```java
Content-Type  multipart/form-data: boundary=AaB03x

--AaB03x
엔티티
--AaB03x
엔티티
--AaB03x--
```

- 엔티티를 구분하기 위해 {—boundary문자열}을 사용
- 멀티파트의 마지막에는 {—boundary문자열—}

## 레인지 리퀘스트

 리줌 다운로드 중에 커넥션이 끊기면, 이전에 다운로드를 한 곳부터 다운로드를 재개할 수 있음
이를 위해서는 엔티티의 범위(레인지)를 지정해서 다운로드를 해야함. 이를 레인지 리퀘스트라고 함.

```java
GET /tip.jpg HTTP/1.1
Host: www.usagidesign.jp
Range: bytes = 5001-10000
```

위와 같이 헤더 필드에 Range를 지정

- Range: bytes = 5001 - 10000
5001 ~ 10000 바이트
- Range: bytes= 5001
5001바이트 이상
- Range: bytes= -3000, 5000-7000
처음부터 3000바이트 그리고 5000부터 7000바이트

레인지 리퀘스트에 대한 리스폰스는 206(partial Content)

복수 범위에 대한 리스폰스는 multipart/byteranes

서버가 레인지 리퀘스트를 지원하지 않으면 완전한 엔티티와 함께 리스폰스 200

## 컨텐츠 네고시에이션

→ 같은 컨텐츠(내용)이지만 여러 개의 페이지를 지닌 웹페이지에 대해 다른 웹페이지를 응답하는 기술

ex) google 검색 결과가 한국어 페이지로 응답되는 경우, 영어 페이지로 응답되는 경우

→ 클라이언트가 더 적절한 리소스를 제공받기 위해서 서버가 제공하는 리소스에 교섭하는 것

아래와 같은 언어와 문자 세트, 인코딩 방식 등으로 서버가 판단

- Accept
- Accept-Chraset
- Accept-Encoding
- Accept-Language
- Content-Language

**서버 구동형 네고시에이션(server-driven negotiation)**

→ 리퀘스트 헤더 필드의 정보를 참고해서 서버가 콘텐츠 네고시에이션을 하는 방식

**에이전트 구동형 네고시에이션(Agent-driven negotiation)**

→ 클라이언트에서 콘텐츠 네고시에이션을 하는 방식으로 유저가 수동으로 선택할 수 있음
js 등을 사용하여 웹 페이지에서 자동적으로 정하게 할 수도 있음.

**트랜스페어런트 네고시에이션(Transparent negotiation)**

→ 서버와 클라이언트가 각각 콘텐츠 네고시에이션을 하는 방식