# HTTP 정보는 HTTP 메시지에 있다

## HTTP 메시지

: HTTP 에서 서버와 클라이언트가 데이터를 교환하는 방식 ( 리퀘스트 메시지, 리스폰스 메시지 )

헤더와 바디로 구성 → 개행문자로 구분!

바디는 항상 존재할까? NO!

## 헤더의 구성

< 공통 >

- 엔티티 헤더필드
- 일반 헤더필드
- 그 외
    - 쿠키 등..

< 리퀘스트 메시지 >

- 리퀘스트 헤더필드
- 리퀘스트 라인
    - 메소드 (GET, POST 등.. )
    - URI
    - HTTP 버전
    

< 리스폰스 메시지 >

- 리스폰스 헤더필드
- 상태라인
    - 결과 상태 코드
    - 설명
    - HTTP 버전
    

## 메시지바디 vs 엔티티바디

- 메시지
    - HTTP 통신의 기본 단위
    - 옥텟시퀀스로 구성
    - 통신을 통해 전송
    
- 엔티티
    - 실제 적재되는 데이터 그 자체, payload라고도 함
    - 엔티티헤더 & 엔티티바디 로 구성

메시지 바디가 엔티티 바디를 운반함!

기본적으로 메시지바디 == 엔티티바디 이니지만, 전송코딩이 적용된 경우 엔티티 바디의 내용이 데이터 그 자체가 아니라 인코딩 된 데이터가 되므로 달라지게 된다!

## 인코딩

: 다량의 접근을 효율적으로 처리하기 위하여 데이터를 조작하는 것
  → 인코딩을 하기 위한 CPU 등의 리소스가 필요하다는 단점이 있다.

- 콘텐츠 코딩
    - 엔티티의 정보들을 압축한다.
    - 수신한 클라이언트에서 디코딩하여 사용한다.
    - 종류 : gzip , compress, deflate, identity 등
- 청크 전송 코딩
    - 데이터의 사이즈가 큰 경우 이를 분할하여 전송한다.
    - 이때 분할된 하나의 단위를 `청크`라고 한다
    - 각 청크는 16진수를 이용하여 구분한다.
    - 마지막 청크가 끝났음을 표시하기 위해  “0(CR+LF)” 를 이용한다.
    - 수신한 클라이언트 측에서 청크들을 모아 원래의 엔티티로 디코딩하여 사용한다.

## 멀티파트

: 여러 다른 종류의 데이터를 수용하는 것.

하나의 메시지바디 내부에 서로다른 엔티티를 담아 전송할 수 있다.

주로 이미지, 텍스트 파일등을 전송해야할 때 이용한다.

< 종류 >

- multipart / form-data
    - web에서 파일을 업로드할 때 이용한다
    - 미션에서 html form 태그로 사용했던 것이 이거임!
- multipart / byteranges
    - 상태코드 206 response 메시지가 여러 범위의 내용을 포함할 때 이용한다.

< HTTP 메시지에 담기는 방식 >

- Content-type 헤더 필드에 담는다!
- 제일 앞에 `boundary` 라는 문자열을 붙임으로써 구분한다.
- 각 엔티티의 앞에  `ㅡㅡ`  를 붙임으로써 새로운 엔티티가 시작되었음을 알린다.
- 마지막 엔티티의 뒤에 `ㅡㅡ`  를 붙임으로써 모든 엔티티가 종료되었음을 알린다.

## 레인지 리퀘스트

: 원하는 범위의 엔티티만을 요청하는 것.

- 레인지 헤더 필드를 이용한다
    - `Range : bytes = A-Z` : A부터 Z까지
    - `Range : bytes = A-` : A부터 끝까지
    - `Range : bytes = -A,B-Z` : 처음부터 A까지 & B부터 Z까지
- 상태코드 206 (partial content) 이 되돌아온다
- 여러 범위를 요청했다면 mutipart / byteranges 로 되돌아온다.
- 만약 서버가 레인지 리퀘스트를 지원하지 않는다면, 전체 엔티티와 함께 200 OK 가 되돌아온다.

## 콘텐츠 네고시에이션

: 같은 요청이라도 헤더 필드에 포함된 언어, 문자 세트, 인코딩 방식 등에 따라 다른 응답을 해주는 것

ex) 같은 구글 페이지라도 언어가 한국어인 경우, 영어인 경우에 따라 다르게 표시함!

< 판단기준이 되어줄 헤더 필드 >

- Accept
- Accept-Charset
- Accept-Encoding
- Accept-Language
- Content-Language

< 종류 >

- 서버 구동형 네고시에이션
    - 서버측에서 리퀘스트의 헤더필드를 보고 처리하는 것
    - 브라우저가 보낸 정보를 기준으로 하기 때문에 사용자에게 적절한지는 알 수 없음
- 에이전트 구동형 네고시에이션
    - 클라이언트측에서 처리하는 것
    - 브라우저에 표시된 선택지 중에서 사용자가 수동으로 선택한다.
    - javascript 등을 사용하여 웹페이지에서 자동적으로 정해주기도 한다.
    → ex) PC용, 스마트폰용 웹페이지를 자동으로 전환하는 경우
- 트랜스페어런트 네고시에이션
    - 서버 구동형과 에이전트 구동형을 통합한 것!
    - 둘다 각각 한다.