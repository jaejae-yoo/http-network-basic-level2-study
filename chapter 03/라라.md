# 3장. HTTP 정보는 HTTP 메시에 있다

## HTTP 메시지

- **HTTP 에서 교환하는 정보**
- 리퀘스트 메시지
- 리스폰스 메시지
- 복수 행의 데이터로 구성된 테스트 문자열
- 메시지 헤더 + 메시지 바디로 구성
    - 메시지 헤더 : 서버와 클라이언트가 꼭 처리해야 하는 리퀘스트와 리스폰스 내용과 속성
    - 메시지 바디 : 꼭 전송되는 데이터 그 자체
- 메시지 바디가 항상 존재한다고 할 수 없음

### 리퀘스트 메시지

- 리퀘스트 라인 : 메소드 + 리퀘스트 URI + HTTP 버전
- 리퀘스트 헤더 필드 : 여러 조건 + 속성
- 일반 헤더 필드
- 엔티티 헤더 필드
- 그 외

### 리스폰스 메시지

- 상태 라인 : 상태 코드 + 설명 + HTTP 버전
- 리스폰스 헤더 필드 : 여러 조건 + 속성
- 일반 헤더 필드
- 엔티티 헤더 필드
- 그 외


## 인코딩으로 전송 효율 높이기

- 인코딩으로 다량의 액세스를 효율 좋게 처리 가능
- 인코딩 처리로 인한 CPU 등의 리소스 소비

### 메시지

- HTTP 통신의 기본 단위

### 엔티티

- 리퀘스트랑 리스폰스의 전송되는 정보
- 엔티티 헤더 필드 + 엔티티 바디

### 압축해서 보내는 콘텐츠 코딩

- 엔티티에 적용하는 인코딩 : 엔티티 정보를 유지한채 압축
- 콘텐츠 코딩된 엔티티 -> 수신한 클라이언트 측에서 디코딩

### 분해해서 보내는 청크 전송 코딩

- HTTP 통신에서 리퀘스트한 리소스 전부에서 엔티티 바디의 전송이 완료되지 않으면 브라우저에 표시되지 않음
- 사이즈가 큰 데이터를 전송하는 경우 데이터를 분할해서 조금씩 표시할 수 있음
   
**청크 전송 코딩**

→ 엔티티 바디를 분할하는 기능

- 엔티티 바디를 청크로 분해함
- 청크 사이즈 : 16진수
- 엔티티 바디 끝에 “0(CR+LF)” 를 기록해둠
- 청크 전송 코딩된 엔티티 바디 → 수신한 클라이언트 측에서 디코딩

## 여러 데이터를 보내는 멀티파트

- HTTP도 멀티파트에 대응하고 있어 하나의 메시지 바디 내부에 엔티티를 여러개 포함시켜 보낼 수 있음
- 이미지, 텍스트 파일 등 업로드 할 때 사용

#### 멀티파트

- multipart/form-data
    - web 폼으로 부터 파일 업로드에 사용됨
- multipart/byteranges
    - 상태코드 206(Partial Content) 리스폰스 메시지가 복수 범위의 내용을 포함할 때 사용

## 일부분만 받는 레인지 리퀘스트

- 다운로드 중에 커넥션이 끊어지게 되면 처음부터 다시 다운로드 해야하는 문제
- **리줌**을 통해 이전에 다운로드 한 곳부터 다운로드 재개 가능
- 레인지 리퀘스트
    - `리줌` 기능을 위해 엔티티 범위를 지정해서 다운로드 해야 함
    - 이처럼 번위를 지정해서 리퀘스트 하는 것

### 예시
- 5,001 ~ 10,000 바이트

`Range: bytes = 5001-10000`

- 5,001 바이트 이상

`Range: bytes = 5001-`

- 처음부터 3,000 바이트까지, 그리고 5,000 ~ 7,000 바이트까지의 복수 범위

`Range: bytes = -3000, 5000-7000`

## Content Negotiation

- 내용은 같지만 영어판/한국어판 같이 표시되는 언어가 서로 다른 웹페이지의 경우
- 웹페이지는 각각 주로 사용하는 브라우저가 같은 URI에 엑세스 할 때 각각 언어에 맞는 웹페이지를 표시함
- 이같은 구조를 Content Negotiation 라고 함
- 클라이언트와 서버가 제공하는 리소스의 내용에 대해 교섭하는 것
- 제공하는 리소스를 언어와  문자 세트, 인코딩 방식 기준으로 판단
- 판단 기준 : 리퀘스트 메시지에 포함된 아래와 같은 리퀘스트 헤더 필드
    - Accept
    - Accept-Charset
    - Accept-Encoding
    - Accept-Language
    - Content-Language

#### 서버 구동형 네고시에이션

- 서버 측에서 콘텐츠 네고시에이션을 하는 방식
- 서버 측에서 리퀘스 헤더 필드 정보를 참고해서 자동적으로 처리

#### 에이전트 구동형 네고시에이션

- 클라이언트 측에서 네고시에이션을 하는 방식

#### 트랜스페어런트 네고시에이션

- 서버 구동형과 에이전트 구동형을 혼합한 것
- 서버와 클라이언트가 각각 콘텐츠 네고시에이션을 함
