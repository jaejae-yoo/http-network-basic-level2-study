# 7장 웹을 안전하게 하는 HTTPS

## 7.1 HTTP의 약점

### 평문(암호화 하지 않은) 통신이기 때문에 도청 가능

- TCP/IP의 구조의 통신 내용은 전부 통신 경로 도중에 엿볼 수 있다.
- 서버와 클라이언트가 통신을 할 때, 통신 경로 상에 잇는 네트워크 기기 등을 전부 자기가 소유할 수는 없다.
- 암호화된 통신에서도 의미는 간파할 수 없겠지만 암호화 메시지 자체는 볼 수 있다.
- 네트워크를 흐르고 있는 패킷을 수집하는 것만으로 도청할 수 있다.

**암호화로 도청을 피하다**

- 통신 암호화
    - HTTP에는 암호화 구조는 없지만 SSL이나 TLS라는 다른 프로토콜을 조합해서 통신을 암호화할 수 있다.
    - SSL을 조합한 HTTP를 HTTPS라고 한다.
- 콘텐츠 암호화
    - HTTP가 운반하는 내용을 암호화하는 방법
    - 콘텐츠의 암호화를 유효하게 하기 위해선 클라이언트와 서버가 콘텐츠 암호화나 복호화 구조를 가지고 있어야하므로, 주로 웹 서비스 등에서 사용한다. (평상시 유저가 사용하는 브라우저 등에선 사용 어려움)

### 통신 상대를 확인하지 않기 때문에 위장 가능

- HTTP는 통신 상대를 확인하지 않는다.
- HTTP는 누구던 간에 리퀘스트를 보내면 리스폰스가 반환 되는 구조이기 때문에 상대를 확인하지 않는 게 약점일 수가 있다.

**상대를 확인하는 증명서**

- SSL은 암호화뿐만 아니라 상대를 확인하는 수단으로 증명서를 제공한다.
- 증명서는 신뢰 가능한 제 3자 기관에 의해 발행되며 위조가 상당히 어렵다.

### 완전성을 증명할 수 없기 때문에 변조 가능

- 리퀘스트나 리스폰스가 발신된 후에 상대가 수신할 때까지 변조되어도 상대가 이 사실을 알 수 없다.
- 이와 같은 요청이나 응답을 빼앗아 변조하는 공격을 중간자 공격(Man-in-the-Middle)이라고 한다.

**변조를 방지하려면?**

- HTTP의 완전성을 확인하기 위한 방법은 있지만, 확실하면서 편리한 방법은 아직 존재하지 않는다.
- 자주 사용되는 방법은 MD5나 SHA-1등의 해시를 확인하는 방법과 디지털 서명을 확인하는 방법이다.
- 그러나 확실한 방법은 아니기에 HTTPS를 사용한다.
- SSL에는 다이제스트 기능을 제공하여 완전성을 보증한다.

## HTTP + 암호화 + 인증 + 완전성 = HTTPS

- HTTP의 다양한 보안 문제를 해결하기 위해 HTTPS가 등장했다.
- HTTPS를 사용하면 [https://가](https://가) URI에 포함되며 브라우저에서 자물쇠 마크가 표시되는 등 HTTP와는 다르게 표시되는 경우가 있다.

### 7.22 HTTPS는 SSL의 껍질을 덮어쓴 HTTP

- HTTPS는 새로운 프로토콜은 아니며 HTTP 통신 소켓 부분을 SSL(Secure Socket Layer)이나 TLS(Transport Layer Security)로 대체하고 있을 뿐이다.
- HTTP는 보통 직접 TCP와 통신하지만 SSL을 사용하면 HTTP - SSL - TCP 구조로 통신한다.
- SSL은 현재 세계 어느 곳에서도 널리 사용되는 네트워크 보안 기술이다.

### 7.2.3 상호간에 키를 교환하는 공개키 암호화 방식

- SSL에서는 공개키 암호화 방식을 채용하고 있다.
- 암호화나 복호화할 때 키가 필요하다. 키만 있으면 누구라도 암호 풀기 가능
- **공통키 암호의 딜레마**
    - 암호화 복호화에 하나의 키를 같이 사용하는 방식을 **공통키 암호화**라고 함
    - 때문에 상대방에게 키를 넘겨줘야 한다. (도청 가능성!)
- **두 개의 키를 사용하는 공개키 암호**
    - **공개키**(알려져도 되는 키)와 **비밀키**(알려지면 안되는 키)의 쌍을 사용
    1. 암호를 보내는 측이 상대의 공개키를 사용해 암호화
    2. 암호화된 정보를 받아들린 상대는 자신의 비밀키를 사용해 복호화
    3. 암호를 푸는 비밀키를 통신으로 보낼 필요가 없어 도청 가능성 없음
    4. 암호화 + 공개키로는 암호를 해독하기 매우 어려움
- **HTTPS는 하이브리드 암호 시스템**
    - HTTP는 공통키 암호화 공개키 암호의 양쪽 성질을 가진 하이브리드 시스템
    - 공개키 암호는 공통키 암호에 비해 처리 속도가 느림
    - 때문에 키를 교환하는 곳에서 공개키 암호를 사용하고 그 후의 통신에서 메시지를 교환하는 곳에서는 공통키 암호를 사용한다.

### 7.2.4 공개키가 정확한지 아닌지를 증명하는 증명서

- 공개키 암호에도 문제점이 있다.
- 상대로부터 받은 공개키가 진짜인지 증명할 수 없다.
- 때문에 신뢰할 수 있는 제3자 기관(VeriSign사 등)의 공개키 증명서가 이용된다.

### 왜 항상 HTTPS를 사용하지 않는가?

- 암호화 통신은 CPU나 메모리 등 리소스가 많이 필요하기 때문이다.
- 때문에 민감한 정보를 다룰 때만 HTTPS에 의한 암호화 통신을 사용한다.
- 특히 엑세스가 많은 웹 사이트 등에서 암호화를 사용하면 부하가 상당하다.
- 그 외에 증명서를 구입하는 비용을 절약하고 싶다는 이유가 있다.
