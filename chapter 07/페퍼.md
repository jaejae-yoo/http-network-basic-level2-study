# 웹을 안전하게 지켜주는 HTTPS 
## HTTP의 약점
### 1. 평문이기 때문에 도청 가능
- HTTP는 암호화 하지 않았기 때문에, 통신 전체가 암호화되지 않는다. 결국 평문(암호화하지 않은 메세지)으로 HTTP 메시지를 보낸다.
- TCP/IP의 구조의 통신 내용은 모두 통신 경로 도중 도청할 수 있다.
- 네트워크 상 흐르는 패킷을 수집하는 것만으로도 도청이 가능하다.

**암호화로 도청 피하기**
- 통신 암호화
  - SSL 또는 TLS라는 다른 프로토콜을 조합하여 HTTP의 통신 내용을 암호화하는 방법
  - SSL 등을 이용해 안전한 통신로를 확립 ➡️ 통신로를 사용하여 HTTP 통신
- 콘텐츠 암호화
  - 통신하고 있는 콘텐츠의 내용 자체를 암호화하는 방법. HTTP 메시지에 포함되는 콘텐츠만 암호화
  - 클라이언트와 서버가 콘텐츠의 암호화나 복호화 구조를 가져야 함.
  - 평상시 유저가 사용하는 브라우저 및 웹 서버에서 이용은 어려움.
  - 주로 웹 서비스에서 사용

### 2. 통신 상대를 확인하지 않기 때문에 위장 가능
- HTTP를 사용한 리퀘스트나 리스폰스에서는 통신 상대(리퀘스트나 리스폰스의 출처)를 확인하지 않는다.
- 누구나 리퀘스트를 보내면 리스폰스가 반환되는 구조이다.
- 위장한 웹 서버, 위장한 클라이언트일 우려가 있다
- 웹 서버는 특정 상대만 통신을 허가하고 싶을 수 있다.
- 대량의 리퀘스트에 의한 DoS 공격을 방지할 수 없다.

**상대를 확인하는 방법**  
SSL은 암호화 뿐 아니라 상대를 확인하는 수단으로 증명서를 제공한다. 증명서는 신뢰할 수 있는 제3자 기관에 의해 발행되어 서버나 클라이언트가 실재한다는 사실을 증명한다. 
증명서를 이용하여 통신 상대가 내가 통신하고자하는 서버임을 나타내고, 이용자는 개인 정보 누설 등의 위험성이 줄어든다.

### 3. 완전성을 증명할 수 없기 때문에 변조 가능
- 리퀘스트나 리스폰스가 발신된 후 항대가 수신할 때까지 변조된 경우, 해당 사실을 알 수 없다.  
  - 중간자 공격(Man-in-the-Middle 공격): 공격자가 리퀘스트나 리스폰스를 빼앗아 도중에 변조하는 공격

**변조를 방지하는 방법**
- MD5 또는 SHA-1 등의 해시 값을 확인하는 방법
- 파일의 디지털 서명을 확인하는 방법
- 하지만 위와 같은 값도 적절하게 수정된 경우, 유저는 변조의 유무를 알 수 없다. ➡️ SSL(인증, 암호화, 다이제스트 기능 제공), 다른 프로토콜 조합


## HTTPS
- HTTP에 암호화나 인증 등의 구조를 더한 것.  
- URI에 `http://`가 아닌 `https://`를 사용
- 새로운 애필리케이션 계층의 프로토콜이 아닌, 소켓 부분을 SSL이나 TLS라는 프로토콜로 대체한 것
  - HTTP ↔️ SSL ↔️ TCP

**공개키 암호화 방식**
- 서로 다른 두 개의 키 페어를 사용. 비밀키와 공개키
- 암호를 보내는 측에서 상대의 공개키를 사용해 암호화
- 정보를 받아들이는 측에서 자신의 비밀키를 사용해 복호화
- 도청에 의해 키를 빼앗기는 위험이 없으며 암호문과 공개키로 평문을 구하는 것은 어려움
- 처리 속도가 느림
- HTTPS는 하이브리드 암호 시스템
  - 키를 교환하는 곳에서는 공개키 암호 사용
  - 이후의 통신에서 메세지 교환하는 곳에서는 공통키 암호 사용

**공개키 판단 증명서**
공개키 암호는 공개키가 진짜인지 증명할 수 없다는 단점 존재. 인증 기관(CA:Certificate Authority)과 기관에서 발행하는 공개키 증명서를 이용하여 문제 해결  
공개키 인증서는 디지털 증명서 or 증명서 라고 함
1. 서버의 운영자가 인증 기관에 공개키 제출
2. 인증 기관은 공개키에 디지털 서명을 완료하여 공개키 생성. 공개키 인증서에 공개키를 담음
3. 서버는 인증기관에서 작성된 공개키 인증서를 클라이언트에게 보내고 공개키 암호로 통신
4. 증명서를 받은 클라이언트는 증명 기관의 공개키를 사용하여 서버의 공개키를 신뢰 가능

- EV SSL 증명서
  - 상대방이 실제로 있는 기업인지 확인
  - 피시 사기 방지 의도. 유저가 잘 알지 못하기 때문에 주의해야함
- 클라이언트 증명서
  - 서버 통신 상대가 의도한 클라이언트임을 증명
  - 단점
    - 유료로 구입해야함. 많은 비용 발생
    - 유저가 직접 인스톨 작업을 해야함
    - 클라이언트의 실재만을 증명. 사용자 존재 유무를 증명하지는 못함
- 자기 인증 기관 발행 증명서
  - 독자적으로 구축한 인증 기관. 발행된 증명서를 `나야 나` 인증서라고 지칭
  - 위장의 가능성을 불식할 수 없으므로 쓸데 없음

**SSL & TLS**
- HTTPS에서 사용되는 두 개의 프로토콜. 현재는 SSL3.0, TLS1.0이 주류.
- SSL 통신은 지연 이슈가 존재
  - 통신 속도가 느림
  - CPU나 메모리 등의 리소스를 다량으로 소비하여 처리가 느려짐
  - 근본적인 해결방법이 없어 `SSL 엑셀레이터` 하드웨어를 사용하여 문제를 해결하기도 함
