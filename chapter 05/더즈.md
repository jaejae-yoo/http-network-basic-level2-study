# 5장 HTTP와 연계하는 웹 서버

## 5.1 1대로 멀티 도메인을 가능하게 하는 가상 호스트

- 가상 호스트 기능을 사용하면 물리적으로 서버가 1대지만 가상으로 여러 대가 있는 것처럼 설정하는 것이 가능하다.
- 인터넷에서 도메인명은 DNS에 의해 IP 주소로 변환 된다.
- 1대 서버 안에 있을 때 IP 주소로는 어디에 대한 엑세스인지 알 수 없다.
- 때문에  HTTP 리퀘스트를 보낼 때 호스트명과 도메인 명을 완전히 포함한 URI를 지정하거나 Host 헤더 필드에서 지정해야 한다.

## 5.2 통신을 중계하는 프로그램: 프록시, 게이트웨이, 터널

### 5.2.1 프록시

- 서버와 클라이언트의 양쪽 역할을 하는 중계 프로그램
- 기본적인 동작은 클라이언트에게 받은 리퀘스트를 다른 서버에 전송하는 것
- 리소스 본체를 가진 서버를 오리진 서버라고 하고 오리진 서버로부터 리스폰스를 받아 클라이언트에게 돌려보낸다.
- 프록시 서버를 여러 대 경유하는 것도 가능하다. 중계할 때 Via 헤더필드에 경유한 호스트(프록시 서버) 정보를 추가해야 한다.
- 캐시를 사용한 네트워크 대역 호율적 사용, 특정 웹 사이트에 대한 엑세스 제한, 엑세스 로그 획득 등의 정책을 위해 사용되기도 함
- 프록시의 사용 방법 2 가지
    - 캐시 보존
    - 메시지 변경

### 캐싱 프록시

- 리퀘스트 리스폰스를 중계할 때 캐시를 보존해 두는 타입의 프록시다.
- 같은 리소스에 대한 리퀘스트가 온 경우 오리진 서버를 들리는 것이 아니라 캐시를 리스폰스로 돌려준다.

### 투명 프록시

- 메시지 변경을 하지 않는 타입을 투명 프록시라고 한다.
- 메시지를 변경하면 비투과 프록시

### 5.2.2 게이트웨이

- 다른 서버를 중계하는 서버
- 리퀘스트를 리소스를 보유한 서버인 것처럼 수신하고 클라이언트는 상대가 게이트웨이라는 것을 알지 못할 수도 있다.
- ‘다른 서버’란 HTTP 서버 이외의 서비스를 제공하는 서버이다.
- 클라이언트와 게이트웨이 사이를 암호화하는 등으로 안전하게 접속함으로써 통신의 안정성을 높인다.
- 예: 데이터베이스에 접속, 결제 시스템 등과 연계

### 5.2.3 터널

- 떨어진 두 클라이언트와 서버 사이를 중계하며 접속을 주선하는 중계 프로그램
- 다른 서버와의 통신 경로를 확립한다.
- 이 때 SSL 같은 암호화 통신을 위해 사용하기도 한다.
- 터널은 양쪽 끝의 접속이 끊어질 때 종료한다.

## 5.3 리소스를 보관하는 캐시

- 캐시는 프록시 서버와 클라이언트의 로컬 디스크에 보관된 리소스의 사본이다.
- 캐시를 사용하면 서버와의 통신량과 시간을 절약할 수 있다.
- 캐시 서버는 프록시 서버의 하나로 프록시이다.
- 결과적으로 서버는 같은 리퀘스트를 매번 처리하지 않아도 된다.

### 5.3.1 캐시는 유효기간이 있다.

- 캐시의 사본과 오리진 서버의 원본이 시간이 지남에 따라 달라질 수도 있다.
- 캐시를 가지고 있더라도 오리진 서버로부터 사본의 유효성을 확인해야 한다.

### 5.3.2 클라이언트 측에도 캐시가 있다.

- 브라우저에도 캐시를 가질 수 있다.
- 클라이언트가 보존하는 캐시를 인터넷 임시 파일이라고 한다.
- 캐시 서버와 마찬가지로 오래된 것으로 판단되면 오리진 서버에 유효성을 확인하거나 새 리소스를 획득한다.
